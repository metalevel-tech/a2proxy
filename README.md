# a2proxy

Bash script which generates Apache2 reverse proxy virtual host configuration files, used in my dev lab.

## Deployment and configuration

Clone the repository and execute the following commands:

```bash
cp a2proxy.sh /usr/local/bin/a2proxy
cp dns2pihole.sh /usr/local/bin/dns2pihole
sudo chmod +x /usr/local/bin/{a2proxy,dns2pihole}
cp a2proxy.template.conf /etc/apache2/sites-available/
```

Thus `a2proxy` and `dns2pihole` will be available as shell commands system wide.

`a2proxy` is the main script within this repo. We will use it to generate Apache2 Virtual host configuration files, on the base of `a2proxy.template.conf`.

`dns2pihole` is optional, ti creates entries within [Pi-hole](https://pi-hole.net/)'s DNS table for the created Virtual hosts.

Once the files ar placed in their location review and tweak each of them. As follow

* `a2proxy` have settings section at the beginning, where you can configure the parameters of your test environment. At the end of the functions `create()` and `remove()` you can chain `dns2pihole`. The function `pm2help()` outputs some essential commands for [PM2](https://pm2.keymetrics.io/), you can remove it in case it is not interesting for your project.

* `dns2pihole` also have settings section at the beginning. It is designed to be called by `a2proxy` but also could be used alone.

* Within the leading settings section `a2proxy.template.conf` you can tweak the values of the variables `proxy_secret` and `proxy_cookie`. Don't touch the other variables - `a2proxy` will do that.

The template file `a2proxy.template.conf` constrains a basic Reverse Proxy configuration that will serve well for the most of your projects. Currently it uses SSL/TLS and requires wildcard certificate. Im using one generated by Let's Encrypt. However some complex services require much complex Reverse Proxy configuration. Within the directory `a2-sites-available/` are provided tested example configuration for the following services:

* service...

* service...

Within the directory `a2-confs/` as reference is provided my current Apache2 base configuration.
